/*! videojs-hlsjs - v0.1.10 - 2016-11-10
* Copyright (c) 2016 srgssr; Licensed Apache-2.0 */
!function(a,b,c,d,e){"use strict";var f=b.getComponent("Component"),g=b.getTech("Tech"),h=b.getComponent("Html5"),i=b.options.techOrder.indexOf("html5"),j=b.extend(h,{_initHls:function(){this.hls_=new c(this.options_.hls),this._bindExternalCallbacks(),this.hls_.on(c.Events.MEDIA_ATTACHED,b.bind(this,this.onMediaAttached)),this.hls_.on(c.Events.MANIFEST_PARSED,b.bind(this,this.onManifestParsed)),this.hls_.on(c.Events.LEVEL_SWITCH,b.bind(this,this.onLevelSwitch)),this.hls_.on(c.Events.ERROR,b.bind(this,this.onError)),this.el_.addEventListener("error",b.bind(this,this.onMediaError)),this.wasPaused_=e,this.startPosition_=e,this.endPosition_=e,this.hls_.attachMedia(this.el_)},_getOptionsCallbackForEvent:function(a){var b=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},c=this.options_["on"+b(a)];if(c&&"function"==typeof c)return c},_bindEvtCallback:function(a){var c=this._getOptionsCallbackForEvent(a);c&&this.hls_.on(a,b.bind(this,function(a,b){var c=this._getOptionsCallbackForEvent(a);c(this.hls_,b)}))},_bindExternalCallbacks:function(){var a;for(a in c.Events)Object.prototype.hasOwnProperty.call(c.Events,a)&&this._bindEvtCallback(c.Events[a])},onMediaAttached:function(){this.triggerReady(),this.wasPaused_&&this.pause()},buffered:function(){var a=h.prototype.buffered.call(this);if(this.startPosition_&&a){var b=this.startPosition_,c={length:a.length,_buffer:a,_startPosition:b,start:function(a){return this._buffer.start(a)-this._startPosition},end:function(a){return this._buffer.end(a)-this._startPosition}};return c}return a},_currentFragmentTimeRange:function(){var a;if(this.hls_&&this.hls_.currentLevel>=0){var b=this.hls_.levels[this.hls_.currentLevel].details,c=b.fragments,d=b.isLive,e=c[d?1:0],f=c[d?c.length-3:c.length-1];a={start:e.start,end:f.start+f.duration}}return a?a:{start:0,end:this._getNativeDuration()}},_getNativeDuration:function(){var a=h.prototype.duration.apply(this);return this.endPosition_&&(a=this.endPosition_-(this.startPosition_?this.startPosition_:0)),a},duration:function(){var a=this._currentFragmentTimeRange();return a.end-a.start},setCurrentTime:function(a){var b=a;if(this.endPosition_&&this.endPosition_<=a)b=this.endPosition_;else{var c=this._currentFragmentTimeRange();b=c.start+b,b=c.end<b?c.end:b,b+=this.startPosition_?this.startPosition_:0}h.prototype.setCurrentTime.call(this,b)},currentTime:function(){var a=h.prototype.currentTime.apply(this),b=this._currentFragmentTimeRange(),c=a<b.start?a:a-b.start;return c-=this.startPosition_?this.startPosition_:0,this.endPosition_&&(this.endPosition_>a?this.endPositionReached_=!1:this.endPositionReached_||(this.pause(),this.endPositionReached_=!0,this.trigger("ended"))),this.hls_.currentLevel!==this._lastLevel&&this.trigger("levelswitched"),this._lastLevel=this.hls_.currentLevel,c<0?0:c},ended:function(){return this.endPositionReached_||h.prototype.ended.call(this)},seekable:function(){var a=h.prototype.seekable.apply(this);return a.length>0?{start:function(){return 0},end:function(){return this.duration()}.bind(this),length:1}:a},onManifestParsed:function(){if(this.hls_.startLoad(this.startPosition_),this.autoplay()&&this.paused()&&!this.wasPaused_&&this.play(),this._parseLevels(),this.options_.disableAutoLevel){var a=this._levels[this._levels.length-1];this.setLevel(a),this.hls_.startLevel=a.index}this.trigger("levelsloaded")},onLevelSwitch:function(){this._forceLevel&&this.hls_.loadLevel!==this._forceLevel.index&&(this.hls_.loadLevel=this._forceLevel.index)},_parseLevels:function(){if(this._levels=[],this._forceLevel=e,this.hls_.levels){var a;for(this.options_.disableAutoLevel||(this._levels.push({label:"auto",index:-1}),this._forceLevel=this._levels[0]),a=0;a<this.hls_.levels.length;a++){var b=this.hls_.levels[a];this._levels.push({label:b.height+"p",index:a})}}},_parseParams:function(a){var b={};if(a&&a.length>0){var c,d=a.split("&");for(c=0;c<d.length;c++){var e=d[c].split("=");b[e.shift()]=decodeURIComponent(e.join("="))}}return b},_toUrlParams:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")},_toNumber:function(a){var b=Number(a);return b&&!isNaN(b)?b:e},_setPositionFromSource:function(a){var b=a.indexOf("?"),c=b>0?a.slice(b+1):"",d=b>0?a.slice(0,b):a,e=this._parseParams(c);return e.start&&(this.startPosition_=this._toNumber(e.start),delete e.start),e.end&&(this.endPosition_=this._toNumber(e.end),delete e.end),d+(c.length>0?"?"+this._toUrlParams(e):"")},setSrc:function(a){this.hls_&&this.hls_.destroy(),this._initHls(),this.hls_.loadSource(this._setPositionFromSource(a))},onMediaError:function(a){var b=a.currentTarget.error;if(b&&b.code===b.MEDIA_ERR_DECODE){var d={type:c.ErrorTypes.MEDIA_ERROR,fatal:!0,details:"mediaErrorDecode"};this.onError(a,d)}},onError:function(a,d){var e=[c.ErrorDetails.MANIFEST_LOAD_ERROR,c.ErrorDetails.MANIFEST_LOAD_TIMEOUT,c.ErrorDetails.MANIFEST_PARSING_ERROR];if(b.log.warn('HLSJS: An error occurred: "'+d.details+'"'),e.indexOf(d.details)>=0)this.hls_.destroy();else{if(d.fatal)switch(d.type){case c.ErrorTypes.NETWORK_ERROR:b.log.warn('HLSJS: Network error encountered: "'+d.details+'", trying to recover...'),this.hls_.startLoad();break;case c.ErrorTypes.MEDIA_ERROR:b.log.warn('HLSJS: Media error encountered: "'+d.details+'", trying to recover...'),this.hls_.swapAudioCodec(),this.hls_.recoverMediaError();break;default:b.log.error('HLSJS: Fatal error encountered: "'+d.details+'", aborting playback.'),this.hls_.destroy()}else d.details===c.ErrorDetails.BUFFER_APPENDING_ERROR&&(this.wasPaused_=this.paused(),this.hls_.swapAudioCodec(),this.hls_.recoverMediaError());this.trigger("waiting")}},currentLevel:function(){return this._forceLevel.index===-1?this._levels[this.hls_.currentLevel+1]:this._forceLevel},isAutoLevel:function(){return this._forceLevel.index===-1},setLevel:function(a){this._forceLevel=a,this.hls_.currentLevel=a.index,this.hls_.loadLevel=a.index},getLevels:function(){return this._levels},dispose:function(){return this.hls_&&this.hls_.destroy(),h.prototype.dispose.apply(this)}});j.isSupported=function(){return c.isSupported()},j.canPlaySource=function(a){return!(b.options.hlsjs.favorNativeHLS&&h.canPlaySource(a))&&a.type&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(a.type)&&c.isSupported()},b.options.hlsjs={favorNativeHLS:!0,hls:{autoStartLoad:!1}},f.registerComponent("Hlsjs",j),g.registerTech("Hlsjs",j),i>-1?b.options.techOrder.splice(i,0,"Hlsjs"):b.options.techOrder.push("Hlsjs")}(window,videojs,Hls,document);